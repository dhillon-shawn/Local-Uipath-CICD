name: "Format JUnit XML to HTML"
description: "Converts JUnit XML to HTML using junit2html (cross-OS; requires Python)"
inputs:
  xml_path:     { required: true,  description: "Path to JUnit XML (artifact)" }
  out_path:     { required: false, default: "./email/TestResults.html" , description: "path to results"}
outputs:
  html:
    description: "HTML string"
    value: ${{ steps.embed_report.outputs.html }}

runs:
  using: "composite"
  steps:
    - name: Ensure output dir
      shell: bash
      run: mkdir -p "$(dirname '${{ inputs.out_path }}')"

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
              python-version: '3.x'


    - name: Generate Report from xml
      shell: bash
      id: embed_report
      run: |
              pip install junit2html
              junit2html ${{ inputs.xml_path }} ${{ inputs.out_path }}
              sed -i 's/Generated by junit2html//g' ${{ inputs.out_path }}
              html=$(cat ${{ inputs.out_path }})
              delimiter="HTML_CONTENT_$(cat /proc/sys/kernel/random/uuid)"
              {
                echo "html<<$delimiter"
                echo "$html"
                echo "$delimiter"
              } >> "$GITHUB_OUTPUT"
              
    - name: html preview
      shell: bash
      run: echo "$html"
