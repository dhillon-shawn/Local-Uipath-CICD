name: Pipeline Caller

on:
  push:
    branches:
      - '**'

    paths-ignore:
      - '.github/**'
  pull_request:
    types: [ opened, synchronize, reopened, ready_for_review ]

concurrency:
  group: ${{ github.workflow }}-${{ github.ref_name }}
  cancel-in-progress: true

permissions:
  write-all

jobs:


  pre-check:
    runs-on: ubuntu-latest
    outputs:
      target_env: ${{ steps.check.outputs.target_env }}
      source_ref: ${{ steps.check.outputs.source_ref }}
      skip: ${{ steps.check.outputs.skip }}
    steps:
      - name: set target_env and decide skip
        id: check
        uses: dhillon-shawn/Local-Uipath-CICD/.github/actions/pre-check@main

  pipeline:
    needs: pre-check
    if: ${{ !fromJSON(needs['pre-check'].outputs.skip || 'false') }}
    uses: dhillon-shawn/Local-Uipath-CICD/.github/workflows/pipeline.yml@main
    secrets: inherit
    with:
      target_env: ${{ needs.pre-check.outputs.target_env }}
      source_ref: ${{ needs.pre-check.outputs.source_ref }}
